![스크린샷 2021-11-16 오후 7 42 08](https://user-images.githubusercontent.com/67960152/141970758-fd4900cd-260c-4f5c-88e2-3433f8f18671.png)


## 1. Humanscape 기업 소개
휴먼스케이프는 헬스케어 영역에서 다양한 프로젝트를 진행하며 성장했으며 현재 희귀난치병 환자들을 위한 서비스를 만들고 있습니다. '레어노트' 서비스는 질환에 관한 정보가 절대적으로 부족한 희귀난치성 환자들에게 치료제, 임상시험 등에 관한 정보를 제공합니다. 또한 본인의 변이 유전자를 명확히 파악하여 관련 치료제에 대한 정보력을 높일 수 있도록 유전자 검사를 안내하고 데이터를 보관할 수 있도록 돕습니다.
  
<br>
<br>

## 2. 팀원소개

### 🎩 불4조팀 🎩
### 2021.11.15 ~ 2021.11.17

## 팀원 소개 
![스크린샷 2021-11-16 오후 7 59 14](https://user-images.githubusercontent.com/67960152/141973560-041682da-204b-43a8-89b5-677ac383c753.png)

### 🖥 Backend 3명 🖥
- 정성헌, 안다민, 송빈호
<br>

### 📚 Stack 📚
- **Skill :** [![img](https://camo.githubusercontent.com/0f3eb5f3e4c61d94657f16605ea420a0216673dfb085d100c458ed15be0599d2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f507974686f6e2d3337373641423f7374796c653d666f722d7468652d6261646765266c6f676f3d507974686f6e266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/0f3eb5f3e4c61d94657f16605ea420a0216673dfb085d100c458ed15be0599d2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f507974686f6e2d3337373641423f7374796c653d666f722d7468652d6261646765266c6f676f3d507974686f6e266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/c4c1014e1f168ff271282b67ec9059c3cfc16b2a5cba6e0c7c98c3530f47f45c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446a616e676f2d3039324532303f7374796c653d666f722d7468652d6261646765266c6f676f3d446a616e676f266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/c4c1014e1f168ff271282b67ec9059c3cfc16b2a5cba6e0c7c98c3530f47f45c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446a616e676f2d3039324532303f7374796c653d666f722d7468652d6261646765266c6f676f3d446a616e676f266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/9bf3ab62e0f872ed37f7d590e4577137b2dda11ffb0786f9b858cd39c2dc8c7f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73716c6974652d3039324532303f7374796c653d666f722d7468652d6261646765266c6f676f3d73716c697465266c6f676f436f6c6f723d23303033423537)](https://camo.githubusercontent.com/9bf3ab62e0f872ed37f7d590e4577137b2dda11ffb0786f9b858cd39c2dc8c7f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73716c6974652d3039324532303f7374796c653d666f722d7468652d6261646765266c6f676f3d73716c697465266c6f676f436f6c6f723d23303033423537)
- **Depoly :** [![img](https://camo.githubusercontent.com/9ad32f291fa1163a77cd2e919f8378b38bf66fd9de517178bf890e521178f341/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f415753204543322d3233324633453f7374796c653d666f722d7468652d6261646765266c6f676f3d416d617a6f6e20415753266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/9ad32f291fa1163a77cd2e919f8378b38bf66fd9de517178bf890e521178f341/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f415753204543322d3233324633453f7374796c653d666f722d7468652d6261646765266c6f676f3d416d617a6f6e20415753266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/fbef20533fc559c07dcaae57d63beab86709421dfd5428391a563096c88ead5a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446f636b65722d3234393645443f7374796c653d666f722d7468652d6261646765266c6f676f3d446f636b6572266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/fbef20533fc559c07dcaae57d63beab86709421dfd5428391a563096c88ead5a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446f636b65722d3234393645443f7374796c653d666f722d7468652d6261646765266c6f676f3d446f636b6572266c6f676f436f6c6f723d7768697465)
- **ETC :** [![img](https://camo.githubusercontent.com/fdb91eb7d32ba58701c8e564694cbe60e706378baefa180dbb96e2c1cfb9ec0f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769742d4630353033323f7374796c653d666f722d7468652d6261646765266c6f676f3d476974266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/fdb91eb7d32ba58701c8e564694cbe60e706378baefa180dbb96e2c1cfb9ec0f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769742d4630353033323f7374796c653d666f722d7468652d6261646765266c6f676f3d476974266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/23a917c56e310800a66c58a03447dd42c0dea2abff415ef9719e3e837c1cff82/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769746875622d3138313731373f7374796c653d666f722d7468652d6261646765266c6f676f3d476974687562266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/23a917c56e310800a66c58a03447dd42c0dea2abff415ef9719e3e837c1cff82/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769746875622d3138313731373f7374796c653d666f722d7468652d6261646765266c6f676f3d476974687562266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/879423585ed087f3c973857c43ba7e7d84f52c993d2c937055726339fbf921d9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506f73746d616e2d4646364333373f7374796c653d666f722d7468652d6261646765266c6f676f3d506f73746d616e266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/879423585ed087f3c973857c43ba7e7d84f52c993d2c937055726339fbf921d9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506f73746d616e2d4646364333373f7374796c653d666f722d7468652d6261646765266c6f676f3d506f73746d616e266c6f676f436f6c6f723d7768697465)
<br>

## 3. 기업 과제
### 배포 주소
- http://34.64.141.113:8080/list/
- http://34.64.141.113:8080/trials/C110012

### [필수 포함 사항]
- READ.ME 작성
    - 프로젝트 빌드, 자세한 실행 방법 명시
    - 구현 방법과 이유에 대한 간략한 설명
    - 완료된 시스템이 배포된 서버의 주소
    - 해당 과제를 진행하면서 회고 내용 블로그 포스팅
- Swagger나 Postman을 이용하여 API 테스트 가능하도록 구현

### 확인 사항
- **ORM 사용 필수**
- **데이터베이스는 SQLite로 구현**
- **secret key, api key 등을 레포지토리에 올리지 않도록 유의**
    - README.md 에 관련 설명 명시 필요

### 도전 과제: 스스로에게도 도움이 되는 내용 + 추가 가산점
- 배포하여 웹에서 사용 할 수 있도록 제공
- 임상정보 검색 API 제공

### 과제 안내
다음 사항들을 충족하는 서비스를 구현해주세요.

- 임상정보를 수집하는 batch task
    - 참고: [https://www.data.go.kr/data/3074271/fileData.do#/API 목록/GETuddi%3Acfc19dda-6f75-4c57-86a8-bb9c8b103887](https://www.data.go.kr/data/3074271/fileData.do#/API%20%EB%AA%A9%EB%A1%9D/GETuddi%3Acfc19dda-6f75-4c57-86a8-bb9c8b103887)
- 수집한 임상정보에 대한 API
    - 특정 임상정보 읽기(키 값은 자유)
- 수집한 임상정보 리스트 API
    - 최근 일주일내에 업데이트(변경사항이 있는) 된 임상정보 리스트
        - pagination 기능
- **Test 구현시 가산점이 있습니다.**

### 실행 예제
- Read
```bash
curl localhost:3000/trials/{trial_id}
=> {
      "count": 30,
      "data" : [
         {
            "post" : "test...",
            "author" : "somebody",
            "created_at" : 212312312312312,
            ...
         }, 
         ...
      ]
   }

```
- List
```bash
curl localhost:3000/list
=> {
      "count": 300,
      "data" : [
         {
            "post" : "test...",
            "author" : "somebody",
            "created_at" : 212312312312312,
            ...
         }, 
         ...
      ]
   }
```

## 4. 모델링
![스크린샷 2021-11-16 오후 10 31 56](https://user-images.githubusercontent.com/67960152/141994641-27718887-9493-43b1-a1fa-9ffa8f47ed5f.png)
<br>

## 5. 과제 구현 사항

#### 정성헌

- 페어 프로그래밍(정성헌, 안다민)
  - 수집한 임상정보 전체에 대한 리스트 API 
  - 수집한 임상정보 하나에 대한 디테일 뷰 API
  - 최근 일주일내에 업데이트(변경사항이 있는) 된 임상정보 리스트 API
  - 수집한 임상정보 전체에 대한 리스트 API 와 최근 일주일내에 업데이트(변경사항이 있는) 된 임상정보 리스트 API 에 대한 Pagination 기능
  - 테스트 코드 구현(list, trial, mock server 이용한 테스트 코드 작성)
- Docker를 사용하여 배포용 Docker서버 구현

#### 안다민

- 페어 프로그래밍(정성헌, 안다민)
  - 수집한 임상정보 전체에 대한 리스트 API 
  - 수집한 임상정보 하나에 대한 디테일 뷰 API
  - 최근 일주일내에 업데이트(변경사항이 있는) 된 임상정보 리스트 API
  - 수집한 임상정보 전체에 대한 리스트 API 와 최근 일주일내에 업데이트(변경사항이 있는) 된 임상정보 리스트 API 에 대한 Pagination 기능
  - 테스트 코드 구현(list, trial, mock server 이용한 테스트 코드 작성)

#### 송빈호

- 임상정보를 수집하는 batch task
  - 공공데이터 포털 사이트에서 과제의 OpenApi response 구현
  - 공공데이터 포털로 부터 받은 데이터를 확인하여 DB에 저장 로직 구현
  - 받은 데이터를 끝에서부터 과제 번호를 확인하여 과제번호가 없으면 과제 추가
  - Scheduler를 사용하여 매일 0시에 공공데이터 포털로 부터 Api를 호출하는 로직 구현

#### 그 외
- secret key, api key, algorithm, database등 보안이 필요하다 생각하는 키들은 my_settings.py 파일을 만들어 따로 관리하였습니다.
- my_settings.py 파일은 git에 업로드하지 않았습니다.

## 6. Api 호출
- 수집한 임상정보 전체에 대한 리스트 API(paginagtion)
<img width="943" alt="스크린샷 2021-11-16 오후 9 53 01" src="https://user-images.githubusercontent.com/67960152/141988867-eddc1a1b-43d3-4a44-8263-af9c3b991540.png">

- 수집한 임상정보 하나에 대한 디테일 뷰 API
<img width="943" alt="스크린샷 2021-11-16 오후 9 54 03" src="https://user-images.githubusercontent.com/67960152/141989091-6ae7d076-5075-44ce-8db9-bb60ce3a7464.png">

- scheduler 실행될 때 마다 시간 출력
<img width="400" alt="스크린샷 2021-11-16 오후 9 57 22" src="https://user-images.githubusercontent.com/67960152/141989391-7dfc6b54-f5e8-4bfa-b422-28f5b473fb46.png">


## 7. Testcase(3가지 case)

#### Test : Trial list test 구현
- 성공한 경우 200 반환하는지

![스크린샷 2021-11-16 오후 10 15 53](https://user-images.githubusercontent.com/67960152/142012866-09b28a5e-7ee2-427a-88a8-6832c1a1084e.png)

- 페이지네이션 작동 하는지

![스크린샷 2021-11-16 오후 10 23 47](https://user-images.githubusercontent.com/67960152/142012920-1bec88a6-2625-4316-a5c0-8e0e02632615.png)

- 일주일 내 업데이트 내용인지

![스크린샷 2021-11-16 오후 10 51 00](https://user-images.githubusercontent.com/67960152/142012932-93ed52ad-acc0-47cf-a2db-92f35573fff2.png)


#### Test : Trial detail test 구현
- 성공한 경우 200 반환하는지
- 못 찾을 경우 404 반환하는지

![스크린샷 2021-11-16 오후 11 01 19](https://user-images.githubusercontent.com/67960152/142013060-153c8e62-9f69-43af-806b-dad2192456c7.png)


#### Test : 외부 api mock server test 구현
- mock server 리턴 하는지

![스크린샷 2021-11-17 오전 12 22 02](https://user-images.githubusercontent.com/67960152/142014368-b8dcff87-0d97-4cc7-8615-911fec6424ae.png)


## 8. 추가 구현

#### Open Api response log 저장
- OpenApi가 response 될 때 마다 log를 저장하도록 구현
```python
    f = open("logs/batch_task_log.txt", "a")
    data = f"status_code = {res.status}, datetime = {datetime.now()}\n"
    f.write(data)
    f.close()
```
<img width="457" alt="스크린샷 2021-11-17 오전 12 10 38" src="https://user-images.githubusercontent.com/67960152/142011281-e05939aa-88c6-4628-8368-8cddfcfec18a.png">


## 9. Reference
이 프로젝트는 원티드x위코드 백엔드 프리온보딩 과제 일환으로 8퍼센트(eightpercent)에서 출제한 과제를 기반으로 만들었습니다. 감사합니다.
